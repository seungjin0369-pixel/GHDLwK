<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>🐻 곰돌이 레벨업 게임</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background: linear-gradient(#ffe4b5, #ffb347);
  font-family: "Comic Sans MS", sans-serif;
}
#gameArea {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}
.bear {
  position: absolute;
  width: 80px;
  height: 80px;
  background: brown;
  border-radius: 20px;
  bottom: 50px;
  left: 100px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-weight: bold;
  font-size: 24px;
}
.platform {
  position: absolute;
  width: 120px;
  height: 20px;
  background: #8B4513;
  border-radius: 5px;
}
#level {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 24px;
  font-weight: bold;
}
#gameOver {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 48px;
  color: red;
  display: none;
  font-weight: bold;
}
</style>
</head>
<body>
<div id="gameArea">
  <div class="bear" id="bear">🐻</div>
  <div id="level">레벨: 0</div>
  <div id="gameOver">게임 오버!</div>
</div>

<script>
const bear = document.getElementById("bear");
const gameArea = document.getElementById("gameArea");
const levelEl = document.getElementById("level");
const gameOverEl = document.getElementById("gameOver");

let bearX = 100;
let bearY = 50; // bottom 기준
const bearWidth = 80;
const bearHeight = 80;
let jumping = false;
let jumpTarget = 0;
let jumpSpeed = 8;
let level = 0;
const platforms = [];

// 블록 생성
function createPlatform(x, y){
  const p = document.createElement("div");
  p.classList.add("platform");
  p.style.left = x + "px";
  p.style.bottom = y + "px";
  gameArea.appendChild(p);
  platforms.push(p);
}

// 초기 블록
createPlatform(100, 50);
createPlatform(300, 150);
createPlatform(500, 250);
createPlatform(200, 350);
createPlatform(400, 450);

// 키 입력
document.addEventListener("keydown", e=>{
  if(e.key === "ArrowRight") bearX += 20;
  if(e.key === "ArrowLeft") bearX -= 20;
  if(e.key === "ArrowUp" && !jumping){
    // 점프할 블록 찾기
    const possibleBlocks = platforms.filter(p=>{
      const px = p.offsetLeft;
      const pw = p.offsetWidth;
      return bearX + bearWidth > px && bearX < px + pw;
    }).map(p=>p.offsetTop).filter(py=>py > bearY).sort((a,b)=>a-b);

    if(possibleBlocks.length > 0){
      jumpTarget = possibleBlocks[0];
      jumping = true;
    }
  }
});

// 업데이트 루프
function update(){
  if(jumping){
    if(bearY < jumpTarget){
      bearY += jumpSpeed;
      if(bearY > jumpTarget) bearY = jumpTarget;
    } else {
      jumping = false;
      level += 1;
      levelEl.textContent = "레벨: " + level;
    }
  } else {
    // 자유낙하
    let standing = false;
    platforms.forEach(p=>{
      const px = p.offsetLeft;
      const pw = p.offsetWidth;
      const py = p.offsetTop;
      if(bearX + bearWidth > px && bearX < px + pw && bearY === py - bearHeight){
        standing = true;
      }
    });
    if(!standing && bearY > 0){
      bearY -= jumpSpeed;
    }
  }

  // 화면 밖 방지
  if(bearX<0) bearX=0;
  if(bearX>window.innerWidth-bearWidth) bearX = window.innerWidth-bearWidth;

  // 화면 스크롤
  if(bearY > window.innerHeight/2){
    const delta = bearY - window.innerHeight/2;
    bearY = window.innerHeight/2;
    platforms.forEach(p=>{
      const b = parseFloat(p.style.bottom);
      p.style.bottom = (b - delta) + "px";
      if(parseFloat(p.style.bottom) < -50){
        p.style.bottom = window.innerHeight + Math.random()*100 + 50 + "px";
        p.style.left = Math.random()*(window.innerWidth-120) + "px";
      }
    });
  }

  // 게임 오버 체크
  if(bearY <= 0){
    gameOverEl.style.display = "block";
    return;
  }

  bear.style.left = bearX + "px";
  bear.style.bottom = bearY + "px";

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
